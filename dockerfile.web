FROM python:3.9-slim

RUN apt-get update
RUN apt-get install curl gcc libpq-dev capnproto -y --fix-missing

WORKDIR /caolo
RUN curl -LJO https://github.com/caolo-game/cao-lang/releases/download/v0.1.9/caoc-ubuntu
RUN mv caoc-ubuntu /usr/bin/caoc
RUN chmod +x /usr/bin/caoc

COPY ./web/requirements.txt .
RUN pip install -r requirements.txt
RUN pip install gunicorn

COPY ./web .

RUN caoc --version

ENTRYPOINT [ "sh", "./start.sh"]
