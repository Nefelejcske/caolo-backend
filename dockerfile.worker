FROM rust:latest AS build

WORKDIR /worker

COPY ./Cargo.toml ./Cargo.toml
COPY ./Cargo.lock ./Cargo.lock
COPY ./rust-toolchain ./rust-toolchain

COPY ./simulation/ ./simulation/
COPY ./worker/ ./worker/
COPY ./api/ ./api/
COPY ./cao-lang/ ./cao-lang/
COPY ./webservice/ ./webservice/

RUN cargo install --path worker --root . --no-default-features

# ---------- Copy the built binary to a scratch container, to minimize the image size ----------

FROM ubuntu:latest
WORKDIR /worker
COPY --from=build /worker/bin/caolo-worker /caolo
